<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Groveld Services Contact</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://challenges.cloudflare.com/turnstile/v0/api.js"
      async
      defer
    ></script>
  </head>
  <body>
    <div class="container py-4">
      <form id="contact-form">
        <div class="mb-3">
          <label class="form-label" for="contact-form-name">Full name</label>
          <input
            class="form-control"
            id="contact-form-name"
            type="text"
            name="name"
            placeholder="Name"
            value="Martin Groeneveld"
            required
          />
        </div>

        <div class="mb-3">
          <label class="form-label" for="contact-form-email"
            >Email address</label
          >
          <input
            class="form-control"
            id="contact-form-email"
            type="email"
            name="email"
            placeholder="Email Address"
            value="martin@groveld.com"
            required
          />
        </div>

        <div class="mb-3">
          <label class="form-label" for="contact-form-subject">Subject</label>
          <input
            class="form-control"
            id="contact-form-subject"
            type="text"
            name="subject"
            placeholder="subject"
            value="Hello World"
            required
          />
        </div>

        <div class="mb-3">
          <label class="form-label" for="contact-form-message"
            >Your message</label
          >
          <textarea
            class="form-control"
            id="contact-form-message"
            rows="5"
            name="message"
            placeholder="Message"
            required
          >
Dit is een test!
          </textarea>
        </div>

        <div class="cf-turnstile" data-sitekey="0x4AAAAAAAYrFCIgVRhtP95q"></div>

        <div class="d-grid">
          <button
            class="btn btn-lg btn-primary"
            id="contact-form-submit"
            type="submit"
          >
            Submit
          </button>
        </div>
      </form>
    </div>

    <script>
      // Get the form element with the id "contact-form"
      const form = document.getElementById("contact-form");

      // Add an event listener to the form that triggers the submitForm function when the form is submitted
      form.addEventListener("submit", submitForm);

      // Function to handle form submission
      function submitForm(event) {
        event.preventDefault();

        document
          .querySelectorAll("input, textarea, button")
          .forEach((input) => (input.disabled = true));

        // Get the submit button
        const submitButton = document.getElementById("contact-form-submit");

        // Change the button text to "Sending message..."
        submitButton.textContent = "Sending message...";

        // Create a FormData object from the form
        const formData = new FormData(event.target);

        // Send the form to the Cloudflare Worker that will listen to requests on the "/api/submit" path
        fetch("/api/submit", {
          method: "POST",
          body: formData,
        })
          .then((response) => {
            // Parse the response text and include the response status
            return response.text().then((text) => ({
              text,
              ok: response.ok,
            }));
          })
          .then(({ text, ok }) => {
            // If the request was successful, disable the form
            if (ok) {
              // You can modify/add something else here
              form.removeEventListener("submit", submitForm);
              form.reset();
              // Change the button text to "Message sent!"
              submitButton.textContent = "Message sent!";
              submitButton.classList.add("btn-success");
            } else {
              // If the request was not successful, throw an error
              submitButton.textContent = "Something went wrong!";
              submitButton.classList.add("btn-danger");
              throw new Error();
            }
          })
          // Catch any errors that occur during the fetch request
          .catch(() => {
            console.log("Error");
            // You can add something that should happen when the form failed
          });
      }
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
